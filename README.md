# Telegram Web App - Магазин гитарных струн

**Разработчик: Владимир Вольский**  
**06.08.2025 - начало работы над проектом мобильной версии сайта**  
**22.11.2024 - откат проекта на стабильную версию от 11.22**  
**22.11.2024 - восстановление рабочего состояния проекта - упрощены файлы index.html, app.js, api.php**

## Описание

Веб-приложение для Telegram с бесконечной прокруткой товаров из категории электрогитарных струн с сайта [guitarstrings.com.ua](https://guitarstrings.com.ua/electro).

## Функциональность

- **Бесконечная прокрутка**: Автоматическая загрузка 60 товаров при прокрутке до конца страницы
- **Пагинация**: Поддержка всех страниц категории (до 377 товаров)
- **Реальные данные**: Парсинг товаров с сайта guitarstrings.com.ua
- **Адаптивный дизайн**: Оптимизировано для мобильных устройств
- **Telegram интеграция**: Полная поддержка Telegram Web App API

## Структура файлов

```
├── index.html          # Главная страница
├── style.css           # Стили
├── app.js              # JavaScript логика
├── api.php             # PHP API для парсинга
├── handlers.py         # Обработчики Telegram бота
├── keyboards.py        # Клавиатуры Telegram
├── main.py             # Основной файл бота
└── README.md           # Документация
```

## Установка и настройка

### 1. Требования
- PHP 7.4+ с поддержкой cURL
- Веб-сервер (Apache/Nginx)
- Telegram Bot API

### 2. Настройка бота
1. Создайте бота через @BotFather
2. Получите токен бота
3. Обновите `main.py`:
```python
bot = Bot(token='YOUR_BOT_TOKEN')
```

4. Обновите `keyboards.py`:
```python
web_app = WebAppInfo(url='YOUR_SITE_URL')
```

### 3. Развертывание
1. Загрузите файлы на веб-сервер
2. Убедитесь, что PHP имеет доступ к внешним URL
3. Настройте SSL сертификат (обязательно для Telegram Web App)
4. Запустите бота: `python main.py`

## API Endpoints

### GET /api.php
Получение товаров с пагинацией

**Параметры:**
- `start` (int): Начальная позиция (по умолчанию: 0)
- `limit` (int): Количество товаров (по умолчанию: 60)

**Пример:**
```
GET /api.php?start=60&limit=60
```

**Ответ:**
```json
{
  "success": true,
  "products": [
    {
      "name": "Ernie Ball 2221 Regular Slinky 10-46",
      "image": "https://guitarstrings.com.ua/images/...",
      "oldPrice": 414,
      "newPrice": 350,
      "inStock": true
    }
  ],
  "total": 60,
  "start": 60,
  "limit": 60,
  "hasMore": true
}
```

## Пагинация

Система поддерживает следующие страницы:
- Страница 1: `?start=0` (товары 1-60)
- Страница 2: `?start=60` (товары 61-120)
- Страница 3: `?start=120` (товары 121-180)
- ...
- Последняя страница: `?start=360` (товары 361-377)

## Особенности реализации

### Бесконечная прокрутка
- Автоматическая загрузка при приближении к концу страницы
- Предотвращение дублирования запросов
- Fallback на моковые данные при ошибках API

### Парсинг данных
- Использование cURL для получения HTML
- Регулярные выражения для извлечения данных
- Обработка ошибок и таймаутов

### Оптимизация производительности
- Ленивая загрузка изображений
- Кэширование данных на клиенте
- Минимальные HTTP запросы

## Безопасность

- CORS заголовки для API
- Валидация входных параметров
- Обработка ошибок и исключений
- Защита от XSS атак

## Поддержка

При возникновении проблем:
1. Проверьте логи PHP ошибок
2. Убедитесь в доступности сайта guitarstrings.com.ua
3. Проверьте настройки cURL в PHP
4. Убедитесь в корректности SSL сертификата

## Лицензия

MIT License