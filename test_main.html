<!DOCTYPE html>
<html>
<head>
    <title>Тест основного приложения</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        .debug-panel button {
            margin: 2px;
            padding: 5px 10px;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="debug-panel">
        <h4>Отладка</h4>
        <button onclick="testLoadProducts()">Загрузить товары</button>
        <button onclick="testMockData()">Мок данные</button>
        <button onclick="testAPI()">Тест API</button>
        <button onclick="clearConsole()">Очистить консоль</button>
        <div id="debug-info"></div>
    </div>

    <div class="container">
        <div class="filter-container">
            <div class="title">Сортировать по</div>
            <a href="#" class="filter-btn active" data-sort="availability" data-dir="DESC">
                Наличие товара <span class="sort-arrow">+/-</span>
            </a>
            <a href="#" class="filter-btn" data-sort="price" data-dir="ASC">
                Цена товара
            </a>
            <a href="#" class="filter-btn" data-sort="name" data-dir="ASC">
                Название товара
            </a>
            <a href="#" class="filter-btn" data-sort="rating" data-dir="DESC">
                Рейтинг
            </a>
        </div>
        
        <div class="inner">
            <!-- Товары будут загружены здесь -->
        </div>
        
        <div id="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Загрузка товаров...</p>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>
    <script>
        // Имитируем Telegram WebApp для тестирования
        if (!window.Telegram) {
            window.Telegram = {
                WebApp: {
                    expand: () => console.log('Telegram WebApp expand'),
                    MainButton: {
                        textColor: '#FFFFFF',
                        color: '#2cab37',
                        isVisible: false,
                        show: () => console.log('MainButton show'),
                        hide: () => console.log('MainButton hide'),
                        setText: (text) => console.log('MainButton setText:', text)
                    }
                }
            };
        }

        function testLoadProducts() {
            console.log('=== ТЕСТ ЗАГРУЗКИ ТОВАРОВ ===');
            loadProducts(0);
        }

        function testMockData() {
            console.log('=== ТЕСТ МОКОВЫХ ДАННЫХ ===');
            const api = new ProductAPI();
            const mockData = api.getMockProducts(0, 3);
            console.log('Моковые данные:', mockData);
            
            // Очищаем контейнер и отображаем моковые данные
            const container = document.querySelector('.inner');
            container.innerHTML = '';
            
            mockData.products.forEach((product, index) => {
                const productCard = createProductCard(product, index + 1);
                container.appendChild(productCard);
            });
        }

        async function testAPI() {
            console.log('=== ТЕСТ API ===');
            try {
                const api = new ProductAPI();
                const data = await api.fetchProducts(0, 3);
                console.log('API ответ:', data);
                
                document.getElementById('debug-info').innerHTML = `
                    <strong>API статус:</strong> ${data.success ? 'OK' : 'Ошибка'}<br>
                    <strong>Товаров:</strong> ${data.products ? data.products.length : 0}<br>
                    <strong>Источник:</strong> ${data.message || 'API'}
                `;
            } catch (error) {
                console.error('Ошибка API:', error);
                document.getElementById('debug-info').innerHTML = `
                    <strong>Ошибка API:</strong> ${error.message}
                `;
            }
        }

        function clearConsole() {
            console.clear();
            document.getElementById('debug-info').innerHTML = '';
        }

        // Автоматический тест при загрузке
        window.addEventListener('load', () => {
            console.log('Страница загружена, запускаем автоматический тест...');
            setTimeout(() => {
                testMockData();
            }, 1000);
        });
    </script>
</body>
</html> 