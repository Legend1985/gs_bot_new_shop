<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Онлайн список: 11 калибр электро</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        h1 { margin-bottom: 10px; }
        .controls { margin: 10px 0 20px; }
        button { background: #007bff; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
        button:disabled { background: #9bbcf0; cursor: default; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin: 12px 0; }
        .muted { color: #6b7280; }
        ul { padding-left: 18px; }
    </style>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script>
    async function fetchHtml(url) {
        // Загружаем через локальный прокси, чтобы обойти CORS
        const proxied = `/proxy_fetch?url=${encodeURIComponent(url)}`;
        const resp = await fetch(proxied, { cache: 'no-store' });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        return await resp.text();
    }

    function parseNames(html) {
        // Простой парсер на основе регулярки по заголовкам вида <h3>...Название...</h3>
        // и дополнительных известных классов. Это не на 100% устойчиво, но достаточно для проверки.
        const names = [];
        const container = document.createElement('div');
        container.innerHTML = html;
        const selectors = [
            'h3.product-title', 'h3.title', 'a.title', 'a.product-title', 'h3', 'h2'
        ];
        selectors.forEach(sel => {
            container.querySelectorAll(sel).forEach(el => {
                const t = (el.textContent || '').trim();
                if (t && t.length > 4) names.push(t);
            });
        });
        // Удаляем дубли
        const seen = new Set();
        const unique = [];
        names.forEach(n => { if (!seen.has(n)) { seen.add(n); unique.push(n); } });
        return unique;
    }

    async function run() {
        const btn = document.getElementById('runBtn');
        btn.disabled = true;
        const url = (document.getElementById('srcUrl').value || '').trim();
        const out = document.getElementById('out');
        out.innerHTML = '<div class="muted">Загружаем...</div>';
        try {
            const html = await fetchHtml(url);
            const names = parseNames(html);
            out.innerHTML = `<div>Найдено позиций: <b>${names.length}</b></div>`;
            const ul = document.createElement('ul');
            names.forEach(n => {
                const li = document.createElement('li');
                li.textContent = n;
                ul.appendChild(li);
            });
            out.appendChild(ul);
        } catch (e) {
            out.innerHTML = `<div style="color:#d32f2f;">Ошибка: ${e.message || e}</div>`;
        } finally {
            btn.disabled = false;
        }
    }
    </script>
</head>
<body>
    <h1>Онлайн список: 11 калибр электро</h1>
    <div class="controls">
        <label class="muted">URL:&nbsp;</label>
        <input id="srcUrl" type="text" value="https://guitarstrings.com.ua/electro/11-electric?limitstart=0&limit=150" style="width:520px; padding:6px;">
        <button id="runBtn" onclick="run()">Загрузить список</button>
    </div>
    <div class="card">
        <div id="out" class="muted">Нажмите «Загрузить список»</div>
    </div>
</body>
</html>


