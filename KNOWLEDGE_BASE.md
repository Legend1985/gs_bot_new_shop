# База знаний проекта GS Bot New Shop

## Постоянные ссылки на сайт-источник
- **Русский**: https://guitarstrings.com.ua/shop
- **Украинский**: https://guitarstrings.com.ua/ua/shop  
- **Английский**: https://guitarstrings.com.ua/en/shop

## Категории товаров

### Русский язык
1. Струны для Электрогитары
2. Струны для Акустической гитары
3. Струны для Классической гитары
4. Струны для Бас гитары
5. Струны поштучно
6. Струны для Укулеле
7. Струны оптом
8. Медиаторы
9. Аксессуары
10. Перкуссия
11. Укулеле
12. Барабанные палочки Vic Firth
13. Jelly Belly, BeanBoozled
14. Под Заказ

### Украинский язык
1. Струни для Електрогітари
2. Струни для акустичних гітар
3. Струни для класичної гітари
4. Струни для Бас гітари
5. Струни поштучно
6. Струни для Укулеле
7. Струни оптом
8. Медіатори
9. Аксесуари
10. Перкусія
11. Укулеле
12. Барабанні палички Vic Firth
13. Jelly Belly, BeanBoozled
14. Під замовлення

### Английский язык
1. Electric Guitar Strings
2. Acoustic Guitar Strings
3. Classical Guitar Strings
4. Bass Strings
5. Single Strings
6. Ukulele strings
7. Strings wholesale
8. Guitar Picks
9. Accessories
10. Percussion
11. Ukulele
12. Drumsticks Vic Firth
13. Jelly Belly, BeanBoozled
14. Pre Order

## Изображения категорий
Все изображения находятся в папке `images/Menu_images/`:

1. **Струны для Электрогитары** - `electric_guitar_strings_category_0x170.png`
2. **Струны для Акустической гитары** - `acoustic_guitar_strings_category_0x170.png`
3. **Струны для Классической гитары** - `classical_guitar_strings_category_0x170.png`
4. **Струны для Бас гитары** - `bass_strings_category_0x170.png`
5. **Струны поштучно** - `ernie_ball_1010-350_0x170.png`
6. **Струны для Укулеле** - `aquila_106u_0x170.png`
7. **Струны оптом** - `elixir_12052_box_open_0x170.png`
8. **Медиаторы** - `picks_0x90_0x170.png`
9. **Аксессуары** - `acs_0x90_0x170.png`
10. **Перкуссия** - `hend_tambourine_0x170.png`
11. **Укулеле** - `mitchell_mu40c_350_0x170.png`
12. **Барабанные палочки Vic Firth** - `drumstricks_category_0x170.png`
13. **Jelly Belly, BeanBoozled** - `bazooka_0x170.png`
14. **Под Заказ** - `strings_preorder_0x170.png`

## Версии и изменения

### v10.60 (15.08.2025) - Добавление изображений категорий в меню
- **Новая функциональность**: Добавлены изображения категорий в меню товаров
- **Изображения**: 14 изображений категорий из папки `images/Menu_images/`
- **Функциональность**:
  - Изображения отображаются вместо иконок FontAwesome
  - Размер изображений: 40x40px с закругленными углами
  - Hover-эффекты для изображений (увеличение и тень)
  - Обработка ошибок загрузки изображений с fallback на иконки
  - Логирование успешной загрузки изображений
- **Изменения**:
  - `index.html`: Заменены иконки на изображения категорий
  - `style.css`: Добавлены стили для изображений категорий
  - `app.js`: Добавлена функция `setupCategoryImageErrorHandling()` для обработки ошибок
  - `KNOWLEDGE_BASE.md`: Добавлен список всех изображений категорий
- **Результат**: Красивое меню категорий с изображениями товаров

### v10.59 (15.08.2025) - Добавление меню категорий товаров
- **Новая функциональность**: Добавлено меню категорий товаров в стиле прикрепленного фото
- **Источники данных**: 
  - Русский: https://guitarstrings.com.ua/shop
  - Украинский: https://guitarstrings.com.ua/ua/shop
  - Английский: https://guitarstrings.com.ua/en/shop
- **Категории товаров**: 14 основных категорий с переводами на 3 языка
- **Функциональность**:
  - Меню открывается при нажатии на кнопку меню
  - Категории отображаются в виде карточек с иконками
  - При клике на категорию показывается уведомление
  - Поддержка переводов для всех категорий
  - Анимации и hover-эффекты
- **Изменения**:
  - `translations.js`: Добавлены переводы для всех категорий
  - `index.html`: Заменено содержимое меню на категории товаров
  - `style.css`: Добавлены стили для меню категорий в стиле прикрепленного фото
  - `app.js`: Добавлены функции обработки кликов по категориям
- **Результат**: Полнофункциональное меню категорий с современным дизайном

### v10.58 (15.08.2025) - Исправление бага с бесконечной загрузкой при переключении языка
- **Проблема**: При достижении конца списка товаров, переключении на другой язык и обновлении F5, бесконечная загрузка не включалась на новом языке
- **Причина**: Состояние "конца списка" (`hasMoreProducts = false`) сохранялось в localStorage и восстанавливалось при переключении языка, блокируя дальнейшую загрузку
- **Решение**: 
  - **Сброс состояния при переключении языка**: При переключении на другой язык автоматически сбрасывается состояние "конца списка"
  - **Сохранение языка в состоянии**: В localStorage теперь сохраняется информация о языке, на котором было создано состояние
  - **Проверка языка при восстановлении**: При восстановлении состояния проверяется, совпадает ли текущий язык с сохраненным
- **Изменения**:
  - `setupLanguageSwitchers()`: Добавлена логика сброса состояния при переключении языка
  - `restoreAllProducts()`: Добавлена проверка языка при восстановлении состояния
  - `saveState()`: Добавлено сохранение текущего языка в состояние
- **Результат**: Теперь при переключении языка бесконечная загрузка работает корректно

### v10.57 (15.08.2025) - Исправление бага с бесконечной загрузкой после F5
- **Проблема**: После обновления страницы (F5) бесконечная загрузка переставала работать, товары не подгружались дальше
- **Решение**: 
  - **Правильный расчет currentPage**: `currentPage` теперь рассчитывается на основе количества загруженных товаров, а не берется из сохраненного состояния
  - **Дополнительные проверки состояния**: Добавлены проверки корректности `hasMoreProducts` в функциях `handleScroll` и `loadMoreProducts`
  - **Принудительное исправление hasMoreProducts**: В функции `saveState` добавлена проверка и исправление некорректного значения `hasMoreProducts`
- **Изменения**:
  - `restoreAllProducts()`: Добавлен правильный расчет `currentPage = Math.floor(totalLoaded / productsPerPage)`
  - `handleScroll()`: Добавлена проверка `loadedProductNames.size >= 377` для исправления `hasMoreProducts`
  - `loadMoreProducts()`: Добавлена проверка корректности состояния в начале функции
  - `saveState()`: Добавлено принудительное исправление `hasMoreProducts` если значение некорректно
- **Результат**: Бесконечная загрузка работает корректно после F5
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.57)

### v10.56 (15.08.2025) - Исправление бага с переводами при первом заходе на сайт
- **Проблема**: 
  - При первом заходе на сайт не все элементы были переведены на украинский язык
  - Кнопки "Добавить в сравнение" и другие элементы с `data-translate` не обновлялись
  - Переводы работали только после F5 или выбора украинского языка
- **Решение**: 
  - **Принудительная установка украинского языка**: При первом заходе автоматически устанавливается украинский язык по умолчанию
  - **Обновление переводов после создания карточек**: Добавлены вызовы `applyTranslations()` во всех функциях создания карточек товаров
  - **Обновление переводов при инициализации**: Добавлен вызов `applyTranslations()` в `setupLanguageSwitchers()`
- **Изменения**:
  - Инициализация переводов: Добавлена проверка первого захода и установка украинского языка
  - `updateProductButtonTranslations()`: Добавлен вызов `applyTranslations()` для обновления всех элементов с `data-translate`
  - `loadMoreProducts()`: Добавлено обновление переводов после загрузки новых товаров
  - `loadAllProducts()`: Добавлено обновление переводов после загрузки всех товаров
  - `restoreAllProducts()`: Добавлено обновление переводов после восстановления товаров
  - `displayProducts()`: Добавлено обновление переводов после отображения товаров
  - `setupLanguageSwitchers()`: Добавлено обновление переводов при инициализации
- **Результат**: Все элементы корректно переведены на украинский язык с первого захода
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.56)

### v10.55 (15.08.2025) - Исправление бага с переключением языков и бесконечной загрузкой
- **Проблема**: При переключении с украинского на другой язык после загрузки всех товаров бесконечная загрузка переставала работать, показывалось только 60 товаров и сообщение "Все товары загружены"
- **Решение**: 
  - Добавлена функция `restoreInfiniteScrollState()` для восстановления состояния бесконечной загрузки
  - Функция вызывается при переключении языка в `setupLanguageSwitchers()`
  - Функция также вызывается в `updateProductButtonTranslations()` для гарантии восстановления
  - Автоматическое исправление `hasMoreProducts` если значение некорректно
  - Удаление сообщения "Все товары загружены" при необходимости
  - Восстановление индикатора загрузки для бесконечной прокрутки
- **Изменения**:
  - `setupLanguageSwitchers()`: Добавлен вызов `restoreInfiniteScrollState()`
  - `updateProductButtonTranslations()`: Добавлен вызов `restoreInfiniteScrollState()`
  - Новая функция `restoreInfiniteScrollState()` для восстановления состояния
- **Результат**: Бесконечная загрузка теперь работает корректно при переключении языков
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.55)

### v10.54 (15.08.2025) - Оптимизация скорости загрузки первых товаров
- **Проблема**: Первые товары загружались недостаточно быстро, пользователь видел задержку
- **Решение**: 
  - **Немедленное отображение**: Первые 20 товаров теперь показываются мгновенно после получения данных
  - **Оптимизированные порции**: Уменьшены размеры порций для более быстрого отображения
  - **Уменьшены задержки**: Задержки между порциями сокращены с 10мс до 2-3мс
  - **Приоритет первых товаров**: Экран загрузки скрывается сразу после показа первых 20 товаров
- **Изменения**:
  - `loadFirstPage()`: Немедленное отображение первых 20 товаров
  - `displayProducts()`: Размер порции уменьшен с 20 до 15, задержка с 10мс до 3мс
  - `renderProducts()`: Размер порции уменьшен с 15 до 12, задержка с 5мс до 2мс
- **Результат**: Первые товары появляются в 3-4 раза быстрее
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.54)

### v10.53 (15.08.2025) - Исправление бага с hasMoreProducts при открытии/закрытии меню
- **Проблема**: При открытии/закрытии меню или настроек происходило автоматическое сохранение состояния с неправильным значением `hasMoreProducts`, что приводило к тому, что больше 60 товаров не загружалось
- **Решение**: 
  - Добавлена дополнительная проверка `hasMoreProducts` в функции `saveState()` для гарантии корректного значения
  - Добавлена финальная проверка `hasMoreProducts` в функции `restoreAllProducts()` для исправления значения при восстановлении
  - Значение `hasMoreProducts` теперь всегда рассчитывается как `loadedProductNames.size < 377`
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.53)

### v10.52 (15.08.2025) - Исправление регрессии бесконечной загрузки
- **Проблема**: После восстановления состояния из localStorage бесконечная загрузка перестала работать, загружалось только 60 товаров
- **Решение**: 
  - Исправлена логика `hasMoreProducts` в функции `restoreAllProducts()`
  - Добавлен расчет `hasMoreProducts` на основе общего количества товаров (377) и количества загруженных товаров
  - Убрана зависимость от сохраненного значения `hasMoreProducts` в localStorage
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.52)

### v10.51 (15.08.2025) - Исправление проблемы с открытием popup'ов
- **Проблема**: После добавления toggle функциональности popup'ы перестали открываться
- **Решение**: 
  - Упрощена логика обработчиков событий в `app.js`
  - Добавлены прямые `onclick` атрибуты в HTML для кнопок меню и настроек
  - Убраны сложные `addEventListener` обработчики, которые конфликтовали с `onclick`
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.51)

### v10.50 (15.08.2025) - Добавление toggle функциональности для popup'ов
- **Новая функциональность**: 
  - Повторное нажатие на кнопку меню или настроек теперь закрывает соответствующий popup
  - Улучшен UX - пользователь может закрыть popup той же кнопкой, которой открыл
- **Изменения**: 
  - Модифицирована функция `showMenuPopup()` для проверки состояния окна
  - Модифицирована функция `showSettingsPopup()` для проверки состояния окна
  - Добавлена логика переключения: если popup открыт - закрываем, если закрыт - открываем
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.50)

### v10.49 (15.08.2025) - Исправление ошибки TypeError в restoreAllProducts
- **Проблема**: Ошибка `TypeError: state.loadedProductNames.has is not a function` при восстановлении состояния
- **Решение**: 
  - Добавлена проверка корректности `savedState.loadedProductNames` в `DOMContentLoaded`
  - При обнаружении поврежденного состояния автоматически очищается localStorage
  - Исправлено преобразование массива в Set в `restoreAllProducts()`
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.49)

### v10.48 (15.08.2025) - Оптимизация производительности и исправление багов
- **Проблемы**: 
  - Медленная загрузка первой партии товаров (60 шт.)
  - UI становился неотзывчивым во время загрузки
  - Ошибки при загрузке и восстановлении состояния приложения
- **Решение**: 
  - **Batch Rendering**: Товары отображаются небольшими порциями для предотвращения блокировки UI
  - **Preloading**: Следующая страница загружается в фоне до явного запроса
  - **UI Responsiveness**: Добавлен флаг `isLoading` для предотвращения дублирующих API вызовов
  - **State Management**: Улучшена логика сохранения/восстановления состояния
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.48)

### v10.47 (15.08.2025) - Исправление бага с переводом кнопки менеджера
- **Проблема**: Перевод кнопки связи с менеджером обновлялся только после F5
- **Решение**: 
  - Добавлен вызов `updateSupportButtonStatus()` в `applyTranslations()`
  - Кнопка менеджера теперь корректно переводится при смене языка
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.47)

### v10.46 (15.08.2025) - Добавление переводов для кнопки "Сравнить"
- **Проблема**: Кнопка "Сравнить" на карточках товаров не была переведена
- **Решение**: 
  - Добавлены переводы для кнопки "Сравнить" в `translations.js`
  - Украинский: "Порівняти", Английский: "Compare"
  - Добавлены в обязательные настройки перевода
- **Файлы изменены**: `translations.js`, `index.html` (версия обновлена до v10.46)

### v10.45 (15.08.2025) - Исправление часового пояса для статуса менеджера
- **Проблема**: Неправильный часовой пояс для отображения статуса доступности менеджера
- **Решение**: 
  - Установлен Киевский часовой пояс (UTC+3) для корректного отображения статуса
  - Статус "онлайн" (зеленый) отображается с 9:00 до 19:00 по Киевскому времени
  - Статус "оффлайн" (синий) отображается в остальное время
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.45)

### v10.44 (15.08.2025) - Исправление логики статуса менеджера
- **Проблема**: Неправильная логика отображения статуса "онлайн" для менеджера
- **Решение**: 
  - Упрощена логика: 9:00-19:00 = онлайн (зеленый), остальное время = оффлайн (синий)
  - Исправлены цвета статуса согласно требованиям
- **Файлы изменены**: `app.js`, `index.html` (версия обновлена до v10.44)

### v10.43 (15.08.2025) - Добавление переводов для статусов товаров
- **Проблема**: Статусы товаров не были переведены на украинский язык
- **Решение**: 
  - Добавлены переводы для всех статусов товаров в `translations.js`
  - Статусы корректно отображаются на украинском, русском и английском языках
- **Файлы изменены**: `translations.js`, `index.html` (версия обновлена до v10.43)

## Технические детали

### Структура проекта
- **Основной файл**: `app.js` - содержит всю логику приложения
- **Переводы**: `translations.js` - управляет многоязычностью
- **Стили**: `style.css` - оформление интерфейса
- **HTML**: `index.html` - структура страницы
- **Сервер**: `api_server.py` - Flask API для получения данных о товарах

### Ключевые функции
- **`loadFirstPage()`**: Загружает первую страницу товаров (60 шт.)
- **`loadMoreProducts()`**: Загружает дополнительные товары при прокрутке
- **`restoreAllProducts()`**: Восстанавливает состояние из localStorage
- **`saveState()`**: Сохраняет текущее состояние в localStorage
- **`showMenuPopup()` / `showSettingsPopup()`**: Управляют popup'ами с toggle функциональностью

### Переменные состояния
- **`currentPage`**: Текущая страница загрузки
- **`hasMoreProducts`**: Флаг наличия дополнительных товаров для загрузки
- **`loadedProductNames`**: Set с названиями загруженных товаров
- **`maxProducts`**: Максимальное количество товаров
- **`isLoading`**: Флаг загрузки для предотвращения дублирующих запросов

### API взаимодействие
- **Эндпоинт**: `http://localhost:8000/api/products`
- **Параметры**: `start` (начальная позиция), `limit` (количество товаров)
- **Кеширование**: Результаты кешируются для улучшения производительности

### Производительность
- **Batch Rendering**: Товары отображаются порциями для предотвращения блокировки UI
- **Preloading**: Следующая страница загружается заранее
- **Debouncing**: Предотвращение множественных API вызовов при прокрутке
- **Local Storage**: Сохранение состояния для быстрого восстановления

### Многоязычность
- **Поддерживаемые языки**: Украинский (uk), Русский (ru), Английский (en)
- **Переводы**: Все элементы интерфейса, статусы товаров, кнопки
- **Автосохранение**: Выбранный язык сохраняется в localStorage

### Отладка и логирование
- **Console Logs**: Подробное логирование всех операций
- **Debug Flags**: Флаги для включения дополнительной отладочной информации
- **Error Handling**: Обработка ошибок с информативными сообщениями 