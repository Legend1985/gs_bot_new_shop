<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<title>Магазин гитарных струн</title>
</head>
<body>
	<h2 style="text-align:center;">Магазин гитарных струн</h2>
	
	<div class="container">
		<div class="inner">
			<!-- Товары будут загружаться динамически -->
		</div>
	</div>
	
	<!-- Индикатор загрузки -->
	<div id="loading-indicator" style="display: none;">
		<div class="loading-spinner-small"></div>
		<p>Загружаем еще товары...</p>
	</div>
	
	<div class="usercard" id="usercard">
		
	</div>

	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script>
		// Инициализация Telegram Web App
		let tg = window.Telegram.WebApp;
		if (tg) {
			tg.expand();
			tg.MainButton.textColor = '#FFFFFF';
			tg.MainButton.color = '#2cab37';
		}

		// Полные данные товаров (как было в рабочей версии)
		const allProducts = [
			{
				id: 1,
				name: 'Ernie Ball 2221 Regular Slinky 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 414,
				newPrice: 350,
				inStock: true,
				availability: 'В наличии'
			},
			{
				id: 2,
				name: 'Rotosound R13 Roto Greys 13-54',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 520,
				newPrice: 420,
				inStock: false,
				availability: 'Нет в наличии'
			},
			{
				id: 3,
				name: 'Dunlop DEN1046 Nickel Wound Light 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 480,
				newPrice: 400,
				inStock: false,
				availability: 'Ожидается'
			},
			{
				id: 4,
				name: 'GHS Boomers GBTM 11-50 Medium',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 550,
				newPrice: 450,
				inStock: true,
				availability: 'В наличии'
			},
			{
				id: 5,
				name: 'Fender 250M Nickel-Plated Steel 11-49 Medium',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 500,
				newPrice: 420,
				inStock: false,
				availability: 'Нет в наличии'
			},
			{
				id: 6,
				name: 'D\'Addario EXL110 Nickel Wound 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 470,
				newPrice: 390,
				inStock: true,
				availability: 'В наличии'
			},
			{
				id: 7,
				name: 'Elixir 12002 Nanoweb Coated 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 650,
				newPrice: 580,
				inStock: true,
				availability: 'В наличии'
			},
			{
				id: 8,
				name: 'DR Strings Tite-Fit 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 580,
				newPrice: 490,
				inStock: false,
				availability: 'Нет в наличии'
			},
			{
				id: 9,
				name: 'La Bella 10-46 Electric Guitar Strings',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 520,
				newPrice: 440,
				inStock: true,
				availability: 'В наличии'
			},
			{
				id: 10,
				name: 'Thomastik-Infeld Power-Bright 10-46',
				image: 'Goods/Electric_guitar_strings/2221/Ernie_Ball_2221_10-46_150.jpg',
				oldPrice: 720,
				newPrice: 650,
				inStock: true,
				availability: 'В наличии'
			}
		];

		// Переменные для пагинации
		let currentPage = 0;
		let isLoading = false;
		let hasMoreProducts = true;
		const productsPerPage = 6;

		// Функция загрузки товаров с пагинацией
		async function loadProducts(page = 0) {
			if (isLoading || !hasMoreProducts) return;
			
			isLoading = true;
			showLoadingIndicator();
			
			// Имитируем задержку загрузки
			await new Promise(resolve => setTimeout(resolve, 500));
			
			const start = page * productsPerPage;
			const end = start + productsPerPage;
			const pageProducts = allProducts.slice(start, end);
			
			if (pageProducts.length > 0) {
				renderProducts(pageProducts);
				currentPage = page;
				
				if (end >= allProducts.length) {
					hasMoreProducts = false;
				}
			} else {
				hasMoreProducts = false;
			}
			
			isLoading = false;
			hideLoadingIndicator();
		}

		// Функция отображения товаров
		function renderProducts(products) {
			const container = document.querySelector('.inner');
			
			products.forEach((product, index) => {
				const productCard = createProductCard(product, `btn${currentPage * productsPerPage + index + 1}`);
				container.appendChild(productCard);
			});
		}

		// Функция создания карточки товара
		function createProductCard(product, btnId) {
			const card = document.createElement('div');
			card.className = 'product-card';
			
			// Определяем статус товара
			let statusClass = '';
			let statusText = product.availability;
			
			if (product.availability === 'В наличии') {
				statusClass = 'in-stock';
			} else if (product.availability === 'Нет в наличии') {
				statusClass = 'out-of-stock';
			} else if (product.availability === 'Ожидается') {
				statusClass = 'expected';
			}
			
			card.innerHTML = `
				<div class="product-card-top">
					<div class="img-container">
						<img src="${product.image}" alt="${product.name}" class="img" onload="this.classList.add('loaded')" onerror="this.style.display='none'">
					</div>
					<h3 class="product-title">${product.name}</h3>
				</div>
				<div class="product-card-bottom">
					<div class="product-status ${statusClass}">${statusText}</div>
					<div class="product-bottom-row">
						<div class="product-prices">
							<div class="old-price">${product.oldPrice} грн</div>
							<div class="new-price">${product.newPrice} грн</div>
						</div>
						<button id="${btnId}" class="btn">Купить</button>
					</div>
				</div>
			`;
			
			// Добавляем обработчик для кнопки
			const button = card.querySelector(`#${btnId}`);
			if (tg) {
				button.addEventListener('click', () => {
					tg.MainButton.text = `Выбрано: ${product.name}`;
					tg.MainButton.show();
				});
			}
			
			return card;
		}

		// Функции для индикатора загрузки
		function showLoadingIndicator() {
			const indicator = document.getElementById('loading-indicator');
			if (indicator) indicator.style.display = 'block';
		}

		function hideLoadingIndicator() {
			const indicator = document.getElementById('loading-indicator');
			if (indicator) indicator.style.display = 'none';
		}

		// Функция загрузки дополнительных товаров при прокрутке
		function handleScroll() {
			if (isLoading || !hasMoreProducts) return;
			
			const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
			const windowHeight = window.innerHeight;
			const documentHeight = document.documentElement.scrollHeight;
			
			if (scrollTop + windowHeight >= documentHeight - 100) {
				loadProducts(currentPage + 1);
			}
		}

		// Добавляем обработчик прокрутки
		window.addEventListener('scroll', handleScroll);

		// Загружаем первую страницу при загрузке
		document.addEventListener('DOMContentLoaded', () => {
			loadProducts(0);
		});
	</script>
</body>
</html>