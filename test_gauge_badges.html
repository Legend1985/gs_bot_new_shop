<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –±–µ–π–¥–∂–µ–π –∫–∞–ª–∏–±—Ä–∞</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .badge-test { padding: 15px; margin: 10px 0; border-radius: 8px; border: 2px solid #ddd; }
        .badge-success { border-color: #28a745; background: #d4edda; }
        .badge-warning { border-color: #ffc107; background: #fff3cd; }
        .badge-error { border-color: #dc3545; background: #f8d7da; }
        .product { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .gauge-badge { display: inline-block; padding: 2px 6px; background: #007bff; color: white; border-radius: 3px; font-size: 11px; margin: 2px; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –±–µ–π–¥–∂–µ–π –∫–∞–ª–∏–±—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤</h1>

    <div id="results"></div>

    <script>
        async function testGaugeBadges() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<div class="badge-test">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>';

            try {
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
                const response = await fetch('http://localhost:8000/api/products?start=0&limit=100');
                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error('–û—à–∏–±–∫–∞ API');
                }

                let results = '';

                // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–∞–ª–∏–±—Ä—É
                const gaugeGroups = {};
                data.products.forEach(product => {
                    const gauge = product.gauge || 'unknown';
                    if (!gaugeGroups[gauge]) {
                        gaugeGroups[gauge] = [];
                    }
                    gaugeGroups[gauge].push(product);
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∫–∞–ª–∏–±—Ä
                ['09', '10', '11'].forEach(gauge => {
                    const products = gaugeGroups[gauge] || [];
                    const sampleProducts = products.slice(0, 3); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —Ç–æ–≤–∞—Ä–∞

                    let status = 'success';
                    let statusText = '‚úÖ –ë–µ–π–¥–∂ —Ä–∞–±–æ—Ç–∞–µ—Ç';

                    if (products.length === 0) {
                        status = 'warning';
                        statusText = '‚ö†Ô∏è –ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ —Å —ç—Ç–∏–º –∫–∞–ª–∏–±—Ä–æ–º';
                    } else if (products.length < 5) {
                        status = 'warning';
                        statusText = `‚ö†Ô∏è –ú–∞–ª–æ —Ç–æ–≤–∞—Ä–æ–≤ (${products.length})`;
                    }

                    results += `
                        <div class="badge-test ${status}">
                            <h3>${gauge} –∫–∞–ª–∏–±—Ä - ${statusText}</h3>
                            <p><strong>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> ${products.length}</p>
                            <div class="product">
                                <strong>–ü—Ä–∏–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤:</strong><br>
                                ${sampleProducts.map(p => `
                                    <div>
                                        ${p.name}
                                        <span class="gauge-badge">${gauge} –∫–∞–ª–∏–±—Ä</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞ Dunlop
                const dunlopProducts = data.products.filter(p =>
                    p.name && p.name.toLowerCase().includes('dunlop') &&
                    p.name.toLowerCase().includes('dhcn1060')
                );

                if (dunlopProducts.length > 0) {
                    results += `
                        <div class="badge-test success">
                            <h3>üé∏ –¢–æ–≤–∞—Ä—ã Dunlop DHCN1060</h3>
                            <p><strong>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> ${dunlopProducts.length}</p>
                            ${dunlopProducts.map(p => `
                                <div class="product">
                                    <strong>${p.name}</strong><br>
                                    <span class="gauge-badge">${p.gauge} –∫–∞–ª–∏–±—Ä</span>
                                    <span>–¶–µ–Ω–∞: ${p.price} –≥—Ä–Ω</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    results += `
                        <div class="badge-test error">
                            <h3>‚ùå –¢–æ–≤–∞—Ä—ã Dunlop DHCN1060 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ static_products.json</p>
                        </div>
                    `;
                }

                resultsEl.innerHTML = results;

            } catch (error) {
                resultsEl.innerHTML = `
                    <div class="badge-test error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                        <p>${error.message}</p>
                        <p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8000</p>
                    </div>
                `;
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = testGaugeBadges;
    </script>
</body>
</html>
